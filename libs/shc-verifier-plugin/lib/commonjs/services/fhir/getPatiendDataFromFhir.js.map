{"version":3,"names":["RESOURCE_TYPES","constants","acceptedSuffix","resolveName","name","res","family","familyName","givenNames","given","join","suffixes","suffix","filter","i","includes","String","length","text","use","getPatientDataFromFhir","credential","entries","vc","credentialSubject","fhirBundle","entry","patientEntry","find","resource","resourceType","PATIENT","fullName","dateOfBirth","names","birthDate","nameList","map","it","formatDateOfBirth"],"sources":["getPatiendDataFromFhir.ts"],"sourcesContent":["import { formatDateOfBirth } from '../../utils/utils'\nimport constants from '../../models/FHIRFieldConstant'\nconst { RESOURCE_TYPES } = constants\nconst acceptedSuffix = ['Jr.',  'Sr.', 'II', 'III', 'IV']\nconst resolveName = ( name: any ): string | null  => {\n  let res: string|null = null\n  if ( name.family ) {\n    const familyName: string = name.family\n    let givenNames: string = ''\n    if ( name.given ) {\n      givenNames = name.given?.join(' ')\n      const suffixes = ( name.suffix ?? [] ).filter( (i: any) => acceptedSuffix.includes( String(i)) )\n      if ( suffixes.length > 0 ) {\n        givenNames = `${String(givenNames)} ${String(suffixes.join(' '))}`\n      }\n      // for( let i  in ( name.suffix ?? [] ) ) {\n      //   let s = String( item )\n      //   console.log(\"testing --------------------\" + s );\n      //   if ( acceptedSuffix.indexOf( s ) >= 0 ) {\n      //     givenNames = `${givenNames} ${s}`\n      //   }\n      // }\n      res = `${familyName} / ${givenNames}`\n    }\n  } else if ( name.text ) {\n    res = `${String( name.text)}`\n  }\n  if ( res != null && name.use ){\n    res = `${String(res)} (${String(name.use)})`\n  }\n  return res\n}\n\nexport const getPatientDataFromFhir = (credential: any): any => {\n  const entries = credential?.vc?.credentialSubject?.fhirBundle?.entry\n\n  const patientEntry = entries?.find(\n    (entry: any) => entry?.resource?.resourceType === RESOURCE_TYPES.PATIENT,\n  ).resource\n\n  let fullName: string = ''\n  let dateOfBirth: string = ''\n  let names = []\n\n  if ( patientEntry ) {\n    const { name, birthDate } = patientEntry\n    const nameList = name\n    if ( name ) {\n      names = nameList.map( (it: any)=> {\n        fullName = resolveName( it ) ?? ''\n        return fullName\n      })\n    }\n\n    dateOfBirth = formatDateOfBirth(birthDate)\n  }\n  return { \n    names,\n    dateOfBirth,\n    resourceType:RESOURCE_TYPES.PATIENT\n  }\n}\n"],"mappings":";;;;;;AAAA;AACA;AAAsD;AACtD,MAAM;EAAEA;AAAe,CAAC,GAAGC,0BAAS;AACpC,MAAMC,cAAc,GAAG,CAAC,KAAK,EAAG,KAAK,EAAE,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC;AACzD,MAAMC,WAAW,GAAKC,IAAS,IAAsB;EACnD,IAAIC,GAAgB,GAAG,IAAI;EAC3B,IAAKD,IAAI,CAACE,MAAM,EAAG;IACjB,MAAMC,UAAkB,GAAGH,IAAI,CAACE,MAAM;IACtC,IAAIE,UAAkB,GAAG,EAAE;IAC3B,IAAKJ,IAAI,CAACK,KAAK,EAAG;MAAA;MAChBD,UAAU,kBAAGJ,IAAI,CAACK,KAAK,gDAAV,YAAYC,IAAI,CAAC,GAAG,CAAC;MAClC,MAAMC,QAAQ,GAAG,CAAEP,IAAI,CAACQ,MAAM,IAAI,EAAE,EAAGC,MAAM,CAAGC,CAAM,IAAKZ,cAAc,CAACa,QAAQ,CAAEC,MAAM,CAACF,CAAC,CAAC,CAAC,CAAE;MAChG,IAAKH,QAAQ,CAACM,MAAM,GAAG,CAAC,EAAG;QACzBT,UAAU,GAAI,GAAEQ,MAAM,CAACR,UAAU,CAAE,IAAGQ,MAAM,CAACL,QAAQ,CAACD,IAAI,CAAC,GAAG,CAAC,CAAE,EAAC;MACpE;MACA;MACA;MACA;MACA;MACA;MACA;MACA;MACAL,GAAG,GAAI,GAAEE,UAAW,MAAKC,UAAW,EAAC;IACvC;EACF,CAAC,MAAM,IAAKJ,IAAI,CAACc,IAAI,EAAG;IACtBb,GAAG,GAAI,GAAEW,MAAM,CAAEZ,IAAI,CAACc,IAAI,CAAE,EAAC;EAC/B;EACA,IAAKb,GAAG,IAAI,IAAI,IAAID,IAAI,CAACe,GAAG,EAAE;IAC5Bd,GAAG,GAAI,GAAEW,MAAM,CAACX,GAAG,CAAE,KAAIW,MAAM,CAACZ,IAAI,CAACe,GAAG,CAAE,GAAE;EAC9C;EACA,OAAOd,GAAG;AACZ,CAAC;AAEM,MAAMe,sBAAsB,GAAIC,UAAe,IAAU;EAAA;EAC9D,MAAMC,OAAO,GAAGD,UAAU,aAAVA,UAAU,yCAAVA,UAAU,CAAEE,EAAE,4EAAd,eAAgBC,iBAAiB,oFAAjC,sBAAmCC,UAAU,2DAA7C,uBAA+CC,KAAK;EAEpE,MAAMC,YAAY,GAAGL,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEM,IAAI,CAC/BF,KAAU;IAAA;IAAA,OAAK,CAAAA,KAAK,aAALA,KAAK,0CAALA,KAAK,CAAEG,QAAQ,oDAAf,gBAAiBC,YAAY,MAAK9B,cAAc,CAAC+B,OAAO;EAAA,EACzE,CAACF,QAAQ;EAEV,IAAIG,QAAgB,GAAG,EAAE;EACzB,IAAIC,WAAmB,GAAG,EAAE;EAC5B,IAAIC,KAAK,GAAG,EAAE;EAEd,IAAKP,YAAY,EAAG;IAClB,MAAM;MAAEvB,IAAI;MAAE+B;IAAU,CAAC,GAAGR,YAAY;IACxC,MAAMS,QAAQ,GAAGhC,IAAI;IACrB,IAAKA,IAAI,EAAG;MACV8B,KAAK,GAAGE,QAAQ,CAACC,GAAG,CAAGC,EAAO,IAAI;QAChCN,QAAQ,GAAG7B,WAAW,CAAEmC,EAAE,CAAE,IAAI,EAAE;QAClC,OAAON,QAAQ;MACjB,CAAC,CAAC;IACJ;IAEAC,WAAW,GAAG,IAAAM,wBAAiB,EAACJ,SAAS,CAAC;EAC5C;EACA,OAAO;IACLD,KAAK;IACLD,WAAW;IACXH,YAAY,EAAC9B,cAAc,CAAC+B;EAC9B,CAAC;AACH,CAAC;AAAA"}