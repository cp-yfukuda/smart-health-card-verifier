{"version":3,"names":["R4Observation","canSupport","entry","isAcceptedResult","getVerifierInitOption","isAcceptedLabResult","coding","resource","code","filter","item","system","length","validate","res","acceptedStatuses","status","isObservationCompleteStatus","includes","String","console","log","Promise","resolve"],"sources":["R4Observation.ts"],"sourcesContent":["import { getVerifierInitOption } from '../../../../../models/Config'\nimport type { ObservationValidator, BundleEntry } from '../../../types' \nclass R4Observation implements ObservationValidator {\n\n  canSupport (entry: BundleEntry): boolean {\n    const isAcceptedResult = getVerifierInitOption().isAcceptedLabResult\n    const coding = ( entry?.resource?.code?.coding ?? [] ).filter(( item: any ) => {\n      return isAcceptedResult( item.system, item.code )\n    })\n    return ( coding.length > 0 )\n  }\n    \n  async validate ( entry: BundleEntry ): Promise<boolean> {\n    let res = true\n    const acceptedStatuses = ['final', 'amended', 'corrected']\n    if ( this.canSupport( entry ) ) {\n      const { status } = entry.resource || ''\n      const isObservationCompleteStatus = acceptedStatuses.includes( String( status )  )\n      console.log('isObservationCompleteStatus - ' + isObservationCompleteStatus)\n      if (!isObservationCompleteStatus) {\n        console.log(`Observation.status should be \"final, amended, corrected\", but it is ${String(status)}`)\n        res = false\n      }\n    } else {\n      res = false\n      console.log(`Observation.system ${String(entry?.resource?.code?.coding)} should be supported`)\n    } \n    return Promise.resolve( res )\n  }\n}\n\nexport default R4Observation\n"],"mappings":";;;;;;;AAAA;;AAEA,MAAMA,aAAN,CAAoD;EAElDC,UAAU,CAAEC,KAAF,EAA+B;IAAA;;IACvC,MAAMC,gBAAgB,GAAG,IAAAC,6BAAA,IAAwBC,mBAAjD;IACA,MAAMC,MAAM,GAAG,CAAE,CAAAJ,KAAK,SAAL,IAAAA,KAAK,WAAL,+BAAAA,KAAK,CAAEK,QAAP,4FAAiBC,IAAjB,8EAAuBF,MAAvB,KAAiC,EAAnC,EAAwCG,MAAxC,CAAiDC,IAAF,IAAiB;MAC7E,OAAOP,gBAAgB,CAAEO,IAAI,CAACC,MAAP,EAAeD,IAAI,CAACF,IAApB,CAAvB;IACD,CAFc,CAAf;IAGA,OAASF,MAAM,CAACM,MAAP,GAAgB,CAAzB;EACD;;EAEa,MAARC,QAAQ,CAAGX,KAAH,EAA0C;IACtD,IAAIY,GAAG,GAAG,IAAV;IACA,MAAMC,gBAAgB,GAAG,CAAC,OAAD,EAAU,SAAV,EAAqB,WAArB,CAAzB;;IACA,IAAK,KAAKd,UAAL,CAAiBC,KAAjB,CAAL,EAAgC;MAC9B,MAAM;QAAEc;MAAF,IAAad,KAAK,CAACK,QAAN,IAAkB,EAArC;MACA,MAAMU,2BAA2B,GAAGF,gBAAgB,CAACG,QAAjB,CAA2BC,MAAM,CAAEH,MAAF,CAAjC,CAApC;MACAI,OAAO,CAACC,GAAR,CAAY,mCAAmCJ,2BAA/C;;MACA,IAAI,CAACA,2BAAL,EAAkC;QAChCG,OAAO,CAACC,GAAR,CAAa,uEAAsEF,MAAM,CAACH,MAAD,CAAS,EAAlG;QACAF,GAAG,GAAG,KAAN;MACD;IACF,CARD,MAQO;MAAA;;MACLA,GAAG,GAAG,KAAN;MACAM,OAAO,CAACC,GAAR,CAAa,sBAAqBF,MAAM,CAACjB,KAAD,aAACA,KAAD,2CAACA,KAAK,CAAEK,QAAR,8EAAC,iBAAiBC,IAAlB,0DAAC,sBAAuBF,MAAxB,CAAgC,sBAAxE;IACD;;IACD,OAAOgB,OAAO,CAACC,OAAR,CAAiBT,GAAjB,CAAP;EACD;;AA1BiD;;eA6BrCd,a"}