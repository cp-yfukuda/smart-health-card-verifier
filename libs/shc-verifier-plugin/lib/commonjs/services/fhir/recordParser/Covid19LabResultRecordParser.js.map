{"version":3,"names":["_fhirTypes","require","_R4Observation","_interopRequireDefault","_utils","obj","__esModule","default","parse","jwsPayload","_jwsPayload$vc","_jwsPayload$vc$creden","_jwsPayload$vc$creden2","_entries$find","parser","R4Observation","labResultData","entries","vc","credentialSubject","fhirBundle","entry","patientURL","find","_entry$resource","resource","resourceType","ResourceType","Patient","fullUrl","observationEntries","filter","_entry$resource2","_entry$resource3","_entry$resource3$subj","Observation","subject","reference","index","resourceItem","push","sortRecordByDateField","_default","exports"],"sources":["Covid19LabResultRecordParser.ts"],"sourcesContent":["import { ResourceType } from '../fhirTypes'\nimport type { RecordEntry } from 'parser-sdk'\nimport R4Observation from './labResultParser/versions/R4Observation'\nimport { sortRecordByDateField } from '../../../utils/utils'\nimport type { JWSPayload, ParserFunction, ObservationParser}  from '../types'\nconst parse: ParserFunction  =(jwsPayload: JWSPayload): RecordEntry[] | null=> {\n  const parser: ObservationParser = new R4Observation()\n  const labResultData:any[] = []\n  const entries: any[] = jwsPayload?.vc?.credentialSubject?.fhirBundle?.entry\n\n  /* 1. get the patient \n     2. get the lab result record for the first patient */\n  \n  const patientURL = entries?.find((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Patient )\n  })?.fullUrl\n\n  const observationEntries = entries?.filter((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Observation &&\n               entry?.resource?.subject?.reference === patientURL )\n  })\n\n  for (const [index, entry] of observationEntries.entries()) {\n    const resourceItem = parser.parse( entry )  \n    labResultData.push({\n      ...resourceItem,\n      index: ( index + 1 ),\n      resourceType: ResourceType.Observation\n    })\n  }\n\n  sortRecordByDateField('effectiveDateTime', labResultData)\n  return labResultData\n}\n\nexport default parse\n"],"mappings":";;;;;;AAAA,IAAAA,UAAA,GAAAC,OAAA;AAEA,IAAAC,cAAA,GAAAC,sBAAA,CAAAF,OAAA;AACA,IAAAG,MAAA,GAAAH,OAAA;AAA4D,SAAAE,uBAAAE,GAAA,WAAAA,GAAA,IAAAA,GAAA,CAAAC,UAAA,GAAAD,GAAA,KAAAE,OAAA,EAAAF,GAAA;AAE5D,MAAMG,KAAqB,GAAIC,UAAsB,IAA0B;EAAA,IAAAC,cAAA,EAAAC,qBAAA,EAAAC,sBAAA,EAAAC,aAAA;EAC7E,MAAMC,MAAyB,GAAG,IAAIC,sBAAa,EAAE;EACrD,MAAMC,aAAmB,GAAG,EAAE;EAC9B,MAAMC,OAAc,GAAGR,UAAU,aAAVA,UAAU,wBAAAC,cAAA,GAAVD,UAAU,CAAES,EAAE,cAAAR,cAAA,wBAAAC,qBAAA,GAAdD,cAAA,CAAgBS,iBAAiB,cAAAR,qBAAA,wBAAAC,sBAAA,GAAjCD,qBAAA,CAAmCS,UAAU,cAAAR,sBAAA,uBAA7CA,sBAAA,CAA+CS,KAAK;;EAE3E;AACF;;EAEE,MAAMC,UAAU,GAAGL,OAAO,aAAPA,OAAO,wBAAAJ,aAAA,GAAPI,OAAO,CAAEM,IAAI,CAAEF,KAAU,IAAK;IAAA,IAAAG,eAAA;IAC/C,OAAS,CAAAH,KAAK,aAALA,KAAK,wBAAAG,eAAA,GAALH,KAAK,CAAEI,QAAQ,cAAAD,eAAA,uBAAfA,eAAA,CAAiBE,YAAY,MAAKC,uBAAY,CAACC,OAAO;EACjE,CAAC,CAAC,cAAAf,aAAA,uBAFiBA,aAAA,CAEfgB,OAAO;EAEX,MAAMC,kBAAkB,GAAGb,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEc,MAAM,CAAEV,KAAU,IAAK;IAAA,IAAAW,gBAAA,EAAAC,gBAAA,EAAAC,qBAAA;IACzD,OAAS,CAAAb,KAAK,aAALA,KAAK,wBAAAW,gBAAA,GAALX,KAAK,CAAEI,QAAQ,cAAAO,gBAAA,uBAAfA,gBAAA,CAAiBN,YAAY,MAAKC,uBAAY,CAACQ,WAAW,IACxD,CAAAd,KAAK,aAALA,KAAK,wBAAAY,gBAAA,GAALZ,KAAK,CAAEI,QAAQ,cAAAQ,gBAAA,wBAAAC,qBAAA,GAAfD,gBAAA,CAAiBG,OAAO,cAAAF,qBAAA,uBAAxBA,qBAAA,CAA0BG,SAAS,MAAKf,UAAU;EAC/D,CAAC,CAAC;EAEF,KAAK,MAAM,CAACgB,KAAK,EAAEjB,KAAK,CAAC,IAAIS,kBAAkB,CAACb,OAAO,EAAE,EAAE;IACzD,MAAMsB,YAAY,GAAGzB,MAAM,CAACN,KAAK,CAAEa,KAAK,CAAE;IAC1CL,aAAa,CAACwB,IAAI,CAAC;MACjB,GAAGD,YAAY;MACfD,KAAK,EAAIA,KAAK,GAAG,CAAG;MACpBZ,YAAY,EAAEC,uBAAY,CAACQ;IAC7B,CAAC,CAAC;EACJ;EAEA,IAAAM,4BAAqB,EAAC,mBAAmB,EAAEzB,aAAa,CAAC;EACzD,OAAOA,aAAa;AACtB,CAAC;AAAA,IAAA0B,QAAA,GAEclC,KAAK;AAAAmC,OAAA,CAAApC,OAAA,GAAAmC,QAAA"}