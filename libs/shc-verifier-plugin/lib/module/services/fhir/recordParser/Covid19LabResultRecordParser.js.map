{"version":3,"names":["ResourceType","R4Observation","sortRecordByDateField","parse","jwsPayload","parser","labResultData","entries","vc","credentialSubject","fhirBundle","entry","patientURL","find","resource","resourceType","Patient","fullUrl","observationEntries","filter","Observation","subject","reference","index","resourceItem","push"],"sources":["Covid19LabResultRecordParser.ts"],"sourcesContent":["import { ResourceType } from '../fhirTypes'\nimport type { RecordEntry } from 'verifier-sdk'\nimport R4Observation from './labResultParser/versions/R4Observation'\nimport { sortRecordByDateField } from '../../../utils/utils'\nimport type { JWSPayload, ParserFunction, ObservationParser}  from '../types'\nconst parse: ParserFunction  =(jwsPayload: JWSPayload): RecordEntry[] | null=> {\n  const parser: ObservationParser = new R4Observation()\n  const labResultData:any[] = []\n  const entries: any[] = jwsPayload?.vc?.credentialSubject?.fhirBundle?.entry\n\n  /* 1. get the patient \n     2. get the lab result record for the first patient */\n  \n  const patientURL = entries?.find((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Patient )\n  })?.fullUrl\n\n  const observationEntries = entries?.filter((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Observation &&\n               entry?.resource?.subject?.reference === patientURL )\n  })\n\n  for (const [index, entry] of observationEntries.entries()) {\n    const resourceItem = parser.parse( entry )  \n    labResultData.push({\n      ...resourceItem,\n      index: ( index + 1 ),\n      resourceType: ResourceType.Observation\n    })\n  }\n\n  sortRecordByDateField('effectiveDateTime', labResultData)\n  return labResultData\n}\n\nexport default parse\n"],"mappings":"AAAA,SAASA,YAAY,QAAQ,cAAc;AAE3C,OAAOC,aAAa,MAAM,0CAA0C;AACpE,SAASC,qBAAqB,QAAQ,sBAAsB;AAE5D,MAAMC,KAAqB,GAAIC,UAAsB,IAA0B;EAAA;EAC7E,MAAMC,MAAyB,GAAG,IAAIJ,aAAa,EAAE;EACrD,MAAMK,aAAmB,GAAG,EAAE;EAC9B,MAAMC,OAAc,GAAGH,UAAU,aAAVA,UAAU,yCAAVA,UAAU,CAAEI,EAAE,4EAAd,eAAgBC,iBAAiB,oFAAjC,sBAAmCC,UAAU,2DAA7C,uBAA+CC,KAAK;;EAE3E;AACF;;EAEE,MAAMC,UAAU,GAAGL,OAAO,aAAPA,OAAO,wCAAPA,OAAO,CAAEM,IAAI,CAAEF,KAAU,IAAK;IAAA;IAC/C,OAAS,CAAAA,KAAK,aAALA,KAAK,0CAALA,KAAK,CAAEG,QAAQ,oDAAf,gBAAiBC,YAAY,MAAKf,YAAY,CAACgB,OAAO;EACjE,CAAC,CAAC,kDAFiB,cAEfC,OAAO;EAEX,MAAMC,kBAAkB,GAAGX,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEY,MAAM,CAAER,KAAU,IAAK;IAAA;IACzD,OAAS,CAAAA,KAAK,aAALA,KAAK,2CAALA,KAAK,CAAEG,QAAQ,qDAAf,iBAAiBC,YAAY,MAAKf,YAAY,CAACoB,WAAW,IACxD,CAAAT,KAAK,aAALA,KAAK,2CAALA,KAAK,CAAEG,QAAQ,8EAAf,iBAAiBO,OAAO,0DAAxB,sBAA0BC,SAAS,MAAKV,UAAU;EAC/D,CAAC,CAAC;EAEF,KAAK,MAAM,CAACW,KAAK,EAAEZ,KAAK,CAAC,IAAIO,kBAAkB,CAACX,OAAO,EAAE,EAAE;IACzD,MAAMiB,YAAY,GAAGnB,MAAM,CAACF,KAAK,CAAEQ,KAAK,CAAE;IAC1CL,aAAa,CAACmB,IAAI,CAAC;MACjB,GAAGD,YAAY;MACfD,KAAK,EAAIA,KAAK,GAAG,CAAG;MACpBR,YAAY,EAAEf,YAAY,CAACoB;IAC7B,CAAC,CAAC;EACJ;EAEAlB,qBAAqB,CAAC,mBAAmB,EAAEI,aAAa,CAAC;EACzD,OAAOA,aAAa;AACtB,CAAC;AAED,eAAeH,KAAK"}