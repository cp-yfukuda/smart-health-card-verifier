{"version":3,"names":["ResourceType","R4Observation","sortRecordByDateField","parse","jwsPayload","parser","labResultData","entries","vc","credentialSubject","fhirBundle","entry","patientURL","find","resource","resourceType","Patient","fullUrl","observationEntries","filter","Observation","subject","reference","index","resourceItem","push"],"sources":["Covid19LabResultRecordParser.ts"],"sourcesContent":["import { ResourceType } from '../fhirTypes'\nimport type { RecordEntry } from 'verifier-sdk'\nimport R4Observation from './labResultParser/versions/R4Observation'\nimport { sortRecordByDateField } from '../../../utils/utils'\nimport type { JWSPayload, ParserFunction, ObservationParser}  from '../types'\nconst parse: ParserFunction  =(jwsPayload: JWSPayload): RecordEntry[] | null=> {\n  const parser: ObservationParser = new R4Observation()\n  const labResultData:any[] = []\n  const entries: any[] = jwsPayload?.vc?.credentialSubject?.fhirBundle?.entry\n\n  /* 1. get the patient \n     2. get the lab result record for the first patient */\n  \n  const patientURL = entries?.find((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Patient )\n  })?.fullUrl\n\n  const observationEntries = entries?.filter((entry: any) => {\n    return ( entry?.resource?.resourceType === ResourceType.Observation &&\n               entry?.resource?.subject?.reference === patientURL )\n  })\n\n  for (const [index, entry] of observationEntries.entries()) {\n    const resourceItem = parser.parse( entry )  \n    labResultData.push({\n      ...resourceItem,\n      index: ( index + 1 ),\n      resourceType: ResourceType.Observation\n    })\n  }\n\n  sortRecordByDateField('effectiveDateTime', labResultData)\n  return labResultData\n}\n\nexport default parse\n"],"mappings":"AAAA,SAASA,YAAT,QAA6B,cAA7B;AAEA,OAAOC,aAAP,MAA0B,0CAA1B;AACA,SAASC,qBAAT,QAAsC,sBAAtC;;AAEA,MAAMC,KAAqB,GAAIC,UAAD,IAAiD;EAAA;;EAC7E,MAAMC,MAAyB,GAAG,IAAIJ,aAAJ,EAAlC;EACA,MAAMK,aAAmB,GAAG,EAA5B;EACA,MAAMC,OAAc,GAAGH,UAAH,aAAGA,UAAH,yCAAGA,UAAU,CAAEI,EAAf,4EAAG,eAAgBC,iBAAnB,oFAAG,sBAAmCC,UAAtC,2DAAG,uBAA+CC,KAAtE;EAEA;AACF;;EAEE,MAAMC,UAAU,GAAGL,OAAH,aAAGA,OAAH,wCAAGA,OAAO,CAAEM,IAAT,CAAeF,KAAD,IAAgB;IAAA;;IAC/C,OAAS,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,+BAAAA,KAAK,CAAEG,QAAP,oEAAiBC,YAAjB,MAAkCf,YAAY,CAACgB,OAAxD;EACD,CAFkB,CAAH,kDAAG,cAEfC,OAFJ;EAIA,MAAMC,kBAAkB,GAAGX,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEY,MAAT,CAAiBR,KAAD,IAAgB;IAAA;;IACzD,OAAS,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,gCAAAA,KAAK,CAAEG,QAAP,sEAAiBC,YAAjB,MAAkCf,YAAY,CAACoB,WAA/C,IACE,CAAAT,KAAK,SAAL,IAAAA,KAAK,WAAL,gCAAAA,KAAK,CAAEG,QAAP,+FAAiBO,OAAjB,gFAA0BC,SAA1B,MAAwCV,UADnD;EAED,CAH0B,CAA3B;;EAKA,KAAK,MAAM,CAACW,KAAD,EAAQZ,KAAR,CAAX,IAA6BO,kBAAkB,CAACX,OAAnB,EAA7B,EAA2D;IACzD,MAAMiB,YAAY,GAAGnB,MAAM,CAACF,KAAP,CAAcQ,KAAd,CAArB;IACAL,aAAa,CAACmB,IAAd,CAAmB,EACjB,GAAGD,YADc;MAEjBD,KAAK,EAAIA,KAAK,GAAG,CAFA;MAGjBR,YAAY,EAAEf,YAAY,CAACoB;IAHV,CAAnB;EAKD;;EAEDlB,qBAAqB,CAAC,mBAAD,EAAsBI,aAAtB,CAArB;EACA,OAAOA,aAAP;AACD,CA5BD;;AA8BA,eAAeH,KAAf"}