{"version":3,"names":["formatDateOfBirth","constants","RESOURCE_TYPES","acceptedSuffix","resolveName","name","res","family","familyName","givenNames","given","join","suffixes","suffix","filter","i","includes","String","length","text","use","getPatientDataFromFhir","credential","entries","vc","credentialSubject","fhirBundle","entry","patientEntry","find","resource","resourceType","PATIENT","fullName","dateOfBirth","names","birthDate","nameList","map","it"],"sources":["getPatiendDataFromFhir.ts"],"sourcesContent":["import { formatDateOfBirth } from '../../utils/utils'\nimport constants from '../../models/FHIRFieldConstant'\nconst { RESOURCE_TYPES } = constants\nconst acceptedSuffix = ['Jr.',  'Sr.', 'II', 'III', 'IV']\nconst resolveName = ( name: any ): string | null  => {\n  let res: string|null = null\n  if ( name.family ) {\n    const familyName: string = name.family\n    let givenNames: string = ''\n    if ( name.given ) {\n      givenNames = name.given?.join(' ')\n      const suffixes = ( name.suffix ?? [] ).filter( (i: any) => acceptedSuffix.includes( String(i)) )\n      if ( suffixes.length > 0 ) {\n        givenNames = `${String(givenNames)} ${String(suffixes.join(' '))}`\n      }\n      // for( let i  in ( name.suffix ?? [] ) ) {\n      //   let s = String( item )\n      //   console.log(\"testing --------------------\" + s );\n      //   if ( acceptedSuffix.indexOf( s ) >= 0 ) {\n      //     givenNames = `${givenNames} ${s}`\n      //   }\n      // }\n      res = `${familyName} / ${givenNames}`\n    }\n  } else if ( name.text ) {\n    res = `${String( name.text)}`\n  }\n  if ( res != null && name.use ){\n    res = `${String(res)} (${String(name.use)})`\n  }\n  return res\n}\n\nexport const getPatientDataFromFhir = (credential: any): any => {\n  const entries = credential?.vc?.credentialSubject?.fhirBundle?.entry\n\n  const patientEntry = entries?.find(\n    (entry: any) => entry?.resource?.resourceType === RESOURCE_TYPES.PATIENT,\n  ).resource\n\n  let fullName: string = ''\n  let dateOfBirth: string = ''\n  let names = []\n\n  if ( patientEntry ) {\n    const { name, birthDate } = patientEntry\n    const nameList = name\n    if ( name ) {\n      names = nameList.map( (it: any)=> {\n        fullName = resolveName( it ) ?? ''\n        return fullName\n      })\n    }\n\n    dateOfBirth = formatDateOfBirth(birthDate)\n  }\n  return { \n    names,\n    dateOfBirth,\n    resourceType:RESOURCE_TYPES.PATIENT\n  }\n}\n"],"mappings":"AAAA,SAASA,iBAAT,QAAkC,mBAAlC;AACA,OAAOC,SAAP,MAAsB,gCAAtB;AACA,MAAM;EAAEC;AAAF,IAAqBD,SAA3B;AACA,MAAME,cAAc,GAAG,CAAC,KAAD,EAAS,KAAT,EAAgB,IAAhB,EAAsB,KAAtB,EAA6B,IAA7B,CAAvB;;AACA,MAAMC,WAAW,GAAKC,IAAF,IAAiC;EACnD,IAAIC,GAAgB,GAAG,IAAvB;;EACA,IAAKD,IAAI,CAACE,MAAV,EAAmB;IACjB,MAAMC,UAAkB,GAAGH,IAAI,CAACE,MAAhC;IACA,IAAIE,UAAkB,GAAG,EAAzB;;IACA,IAAKJ,IAAI,CAACK,KAAV,EAAkB;MAAA;;MAChBD,UAAU,kBAAGJ,IAAI,CAACK,KAAR,gDAAG,YAAYC,IAAZ,CAAiB,GAAjB,CAAb;MACA,MAAMC,QAAQ,GAAG,CAAEP,IAAI,CAACQ,MAAL,IAAe,EAAjB,EAAsBC,MAAtB,CAA+BC,CAAD,IAAYZ,cAAc,CAACa,QAAf,CAAyBC,MAAM,CAACF,CAAD,CAA/B,CAA1C,CAAjB;;MACA,IAAKH,QAAQ,CAACM,MAAT,GAAkB,CAAvB,EAA2B;QACzBT,UAAU,GAAI,GAAEQ,MAAM,CAACR,UAAD,CAAa,IAAGQ,MAAM,CAACL,QAAQ,CAACD,IAAT,CAAc,GAAd,CAAD,CAAqB,EAAjE;MACD,CALe,CAMhB;MACA;MACA;MACA;MACA;MACA;MACA;;;MACAL,GAAG,GAAI,GAAEE,UAAW,MAAKC,UAAW,EAApC;IACD;EACF,CAlBD,MAkBO,IAAKJ,IAAI,CAACc,IAAV,EAAiB;IACtBb,GAAG,GAAI,GAAEW,MAAM,CAAEZ,IAAI,CAACc,IAAP,CAAa,EAA5B;EACD;;EACD,IAAKb,GAAG,IAAI,IAAP,IAAeD,IAAI,CAACe,GAAzB,EAA8B;IAC5Bd,GAAG,GAAI,GAAEW,MAAM,CAACX,GAAD,CAAM,KAAIW,MAAM,CAACZ,IAAI,CAACe,GAAN,CAAW,GAA1C;EACD;;EACD,OAAOd,GAAP;AACD,CA3BD;;AA6BA,OAAO,MAAMe,sBAAsB,GAAIC,UAAD,IAA0B;EAAA;;EAC9D,MAAMC,OAAO,GAAGD,UAAH,aAAGA,UAAH,yCAAGA,UAAU,CAAEE,EAAf,4EAAG,eAAgBC,iBAAnB,oFAAG,sBAAmCC,UAAtC,2DAAG,uBAA+CC,KAA/D;EAEA,MAAMC,YAAY,GAAGL,OAAH,aAAGA,OAAH,uBAAGA,OAAO,CAAEM,IAAT,CAClBF,KAAD;IAAA;;IAAA,OAAgB,CAAAA,KAAK,SAAL,IAAAA,KAAK,WAAL,+BAAAA,KAAK,CAAEG,QAAP,oEAAiBC,YAAjB,MAAkC7B,cAAc,CAAC8B,OAAjE;EAAA,CADmB,EAEnBF,QAFF;EAIA,IAAIG,QAAgB,GAAG,EAAvB;EACA,IAAIC,WAAmB,GAAG,EAA1B;EACA,IAAIC,KAAK,GAAG,EAAZ;;EAEA,IAAKP,YAAL,EAAoB;IAClB,MAAM;MAAEvB,IAAF;MAAQ+B;IAAR,IAAsBR,YAA5B;IACA,MAAMS,QAAQ,GAAGhC,IAAjB;;IACA,IAAKA,IAAL,EAAY;MACV8B,KAAK,GAAGE,QAAQ,CAACC,GAAT,CAAeC,EAAD,IAAY;QAChCN,QAAQ,GAAG7B,WAAW,CAAEmC,EAAF,CAAX,IAAqB,EAAhC;QACA,OAAON,QAAP;MACD,CAHO,CAAR;IAID;;IAEDC,WAAW,GAAGlC,iBAAiB,CAACoC,SAAD,CAA/B;EACD;;EACD,OAAO;IACLD,KADK;IAELD,WAFK;IAGLH,YAAY,EAAC7B,cAAc,CAAC8B;EAHvB,CAAP;AAKD,CA5BM"}