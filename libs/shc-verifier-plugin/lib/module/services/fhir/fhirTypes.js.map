{"version":3,"names":["_","RecordType","ResourceType","availableRecordTypes","immunization","covid19LabResult","acceptedVCType","getRecordTypeFromPayload","fhirJWSPayload","_fhirJWSPayload$vc","res","unknown","types","vc","type","Array","isArray","i","length","recordType","intersection","sort","isResourceType","entry","resourceType","_entry$resource","resource","toLowerCase"],"sources":["fhirTypes.ts"],"sourcesContent":["import _ from 'lodash'\nimport type {JWSPayload, BundleEntry } from './types'\nexport const enum RecordType {\n  'unknown'='unknown',\n  'immunization' = 'immunization',\n  'covid19LabResult'    = 'covid19-lab-result'\n}\n\nexport const enum ResourceType {\n  Unknown      = 'Unknown',\n  Immunization = 'Immunization',\n  Patient      = 'Patient',\n  Observation  = 'Observation'\n}\n\nexport const availableRecordTypes: RecordType[] = [ \n  RecordType.immunization,\n  RecordType.covid19LabResult\n]\nexport const acceptedVCType: Record<string, string[]> = {\n  [RecordType.immunization]: [  \n    'https://smarthealth.cards#immunization',\n    'https://smarthealth.cards#health-card'],\n  [RecordType.covid19LabResult]: [               \n    'https://smarthealth.cards#laboratory',\n    'https://smarthealth.cards#covid19',\n    'https://smarthealth.cards#health-card']\n}\n\n/* this will check if it's validatable types per payload. \n   it also assumes that per each payload it has one record type\n   exclusively, or it fallback to unknown.\n*/\nexport function getRecordTypeFromPayload ( fhirJWSPayload: JWSPayload ): RecordType  {\n  let res = RecordType.unknown\n  const types = fhirJWSPayload?.vc?.type\n  if ( Array.isArray( types ) ) {\n    for ( let i=0; i < availableRecordTypes.length; i++ ) {\n      const recordType = acceptedVCType[availableRecordTypes[i]]\n      if ( _.intersection(types.sort(), recordType.sort()).length === recordType.length ){\n        res = availableRecordTypes[i]\n        break\n      }\n    } \n  }\n  return res\n}\n\nexport function isResourceType ( entry: BundleEntry, resourceType: ResourceType ): boolean {\n  return ( entry?.resource?.resourceType.toLowerCase() === resourceType.toLowerCase() )\n}\n"],"mappings":"AAAA,OAAOA,CAAC,MAAM,QAAQ;AAEtB,WAAkBC,UAAU,0BAAVA,UAAU;EAAVA,UAAU;EAAVA,UAAU;EAAVA,UAAU;EAAA,OAAVA,UAAU;AAAA;AAM5B,WAAkBC,YAAY,0BAAZA,YAAY;EAAZA,YAAY;EAAZA,YAAY;EAAZA,YAAY;EAAZA,YAAY;EAAA,OAAZA,YAAY;AAAA;AAO9B,OAAO,MAAMC,oBAAkC,GAAG,CAChDF,UAAU,CAACG,YAAY,EACvBH,UAAU,CAACI,gBAAgB,CAC5B;AACD,OAAO,MAAMC,cAAwC,GAAG;EACtD,CAACL,UAAU,CAACG,YAAY,GAAG,CACzB,wCAAwC,EACxC,uCAAuC,CAAC;EAC1C,CAACH,UAAU,CAACI,gBAAgB,GAAG,CAC7B,sCAAsC,EACtC,mCAAmC,EACnC,uCAAuC;AAC3C,CAAC;;AAED;AACA;AACA;AACA;AACA,OAAO,SAASE,wBAAwBA,CAAGC,cAA0B,EAAgB;EAAA,IAAAC,kBAAA;EACnF,IAAIC,GAAG,GAAGT,UAAU,CAACU,OAAO;EAC5B,MAAMC,KAAK,GAAGJ,cAAc,aAAdA,cAAc,wBAAAC,kBAAA,GAAdD,cAAc,CAAEK,EAAE,cAAAJ,kBAAA,uBAAlBA,kBAAA,CAAoBK,IAAI;EACtC,IAAKC,KAAK,CAACC,OAAO,CAAEJ,KAAK,CAAE,EAAG;IAC5B,KAAM,IAAIK,CAAC,GAAC,CAAC,EAAEA,CAAC,GAAGd,oBAAoB,CAACe,MAAM,EAAED,CAAC,EAAE,EAAG;MACpD,MAAME,UAAU,GAAGb,cAAc,CAACH,oBAAoB,CAACc,CAAC,CAAC,CAAC;MAC1D,IAAKjB,CAAC,CAACoB,YAAY,CAACR,KAAK,CAACS,IAAI,EAAE,EAAEF,UAAU,CAACE,IAAI,EAAE,CAAC,CAACH,MAAM,KAAKC,UAAU,CAACD,MAAM,EAAE;QACjFR,GAAG,GAAGP,oBAAoB,CAACc,CAAC,CAAC;QAC7B;MACF;IACF;EACF;EACA,OAAOP,GAAG;AACZ;AAEA,OAAO,SAASY,cAAcA,CAAGC,KAAkB,EAAEC,YAA0B,EAAY;EAAA,IAAAC,eAAA;EACzF,OAAS,CAAAF,KAAK,aAALA,KAAK,wBAAAE,eAAA,GAALF,KAAK,CAAEG,QAAQ,cAAAD,eAAA,uBAAfA,eAAA,CAAiBD,YAAY,CAACG,WAAW,EAAE,MAAKH,YAAY,CAACG,WAAW,EAAE;AACrF"}